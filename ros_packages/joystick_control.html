<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Joystick Control &mdash; Interbotix X-Series LoCoBot Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tr_style.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.webp"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Landmark-Based Navigation" href="landmark_based_navigation.html" />
    <link rel="prev" title="Python Demos" href="python_demos.html" />
   
  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe
      src="https://www.googletagmanager.com/ns.html?id=GTM-PZQLS2V"
      height="0"
      width="0"
      style="display:none;visibility:hidden">
    </iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) -->

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/logo_xslocobots.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../specifications/index.html">Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros_interface/index.html">ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_interface/index.html">Python-ROS Interface</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ROS Open Source Packages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="locobot_descriptions.html">LoCoBot Descriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="locobot_control.html">LoCoBot Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="gazebo_simulation_configuration.html">Gazebo Simulation Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros_control.html">ROS Controllers Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="moveit_motion_planning_configuration.html">MoveIt Motion Planning Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="perception_pipeline_configuration.html">Perception Pipeline Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="navigation_stack_configuration.html">Navigation Stack Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="moveit_interface_and_api.html">MoveIt Interface and API</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_demos.html">Python Demos</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Joystick Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#base-control-mode">Base Control Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arm-control-mode">Arm Control Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#both-modes">Both Modes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="landmark_based_navigation.html">Landmark-Based Navigation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Interbotix X-Series LoCoBots Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">ROS Open Source Packages</a></li>
      <li class="breadcrumb-item active">Joystick Control</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/TrossenRobotics/interbotix_xslocobots_docs/blob/main/ros_packages/joystick_control.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="joystick-control">
<h1>Joystick Control<a class="headerlink" href="#joystick-control" title="Permalink to this headline"></a></h1>
<a href="https://github.com/Interbotix/interbotix_ros_rovers/tree/main/interbotix_ros_xslocobots/examples/interbotix_xslocobot_joy"
  class="docs-view-on-github-button"
  target="_blank">
  <img src="../_static/GitHub-Mark-Light-32px.png"
      class="docs-view-on-github-button-gh-logo">
    View Package on GitHub
</a><div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>This package can be used to control the movements of any rover in the Interbotix
X-Series LoCoBot Family using a SONY PS3 or PS4 controller via Bluetooth. In
this demo, the ‘arm’ (if equipped) and ‘pan/tilt’ servos work in ‘position’
control mode, the gripper operates in ‘PWM’ mode, and the Kobuki base operates
in ‘velocity’ control mode. Refer to the joystick button map below to see how to
operate the robot. Specifically, some of the joystick controls manipulate
individual joints while others are used to perform ‘inverse kinematics’ on all
the joints to get the end-effector of the robot (defined at ‘ee_gripper_link’)
to move as if it’s in Cartesian space. This is done using the <a class="reference external" href="https://github.com/NxRLab/ModernRobotics/tree/master/packages/Python" rel="noopener noreferrer" target="_blank">modern_robotics</a>
code library offered by Northwestern University.</p>
</div>
<div class="section" id="structure">
<h2>Structure<a class="headerlink" href="#structure" title="Permalink to this headline"></a></h2>
<img alt="../_images/xslocobot_joy_flowchart.png" class="align-center" src="../_images/xslocobot_joy_flowchart.png" />
<p>As shown above, the <cite>interbotix_xslocobot_joy</cite> package builds on top of the
<cite>interbotix_xslocobot_control</cite> package. To get familiar with the nodes in the
<cite>interbotix_xslocobot_control</cite> package, please look at its README. The other
nodes are described below:</p>
<ul class="simple">
<li><strong>joy</strong> - a ROS driver for a generic Linux joystick; it reads data from a
SONY PS3 or PS4 controller joystick over Bluetooth and publishes
<a class="reference external" href="http://docs.ros.org/melodic/api/sensor_msgs/html/msg/Joy.html" rel="noopener noreferrer" target="_blank">sensor_msgs/Joy</a> messages to the <code class="docutils literal notranslate"><span class="pre">/&lt;robot_name&gt;/commands/joy_raw</span></code> topic</li>
<li><strong>xslocobot_joy</strong> - responsible for reading in raw <a class="reference external" href="http://docs.ros.org/melodic/api/sensor_msgs/html/msg/Joy.html" rel="noopener noreferrer" target="_blank">sensor_msgs/Joy</a>
messages from the <code class="docutils literal notranslate"><span class="pre">/&lt;robot_name&gt;/commands/joy_raw</span></code> topic and converting
them into <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_core/blob/main/interbotix_ros_xseries/interbotix_xs_msgs/msg/LocobotJoy.msg" rel="noopener noreferrer" target="_blank">LocobotJoy</a> messages; this makes the code more readable and
allows users to remap buttons very easily later. The new messages are then
published on the <code class="docutils literal notranslate"><span class="pre">/&lt;robot_name&gt;/commands/joy_processed</span> <span class="pre">topic</span></code>.</li>
<li><strong>xslocobot_robot</strong> - responsible for reading in <a class="reference external" href="https://github.com/Interbotix/interbotix_ros_core/blob/main/interbotix_ros_xseries/interbotix_xs_msgs/msg/LocobotJoy.msg" rel="noopener noreferrer" target="_blank">LocobotJoy</a> messages
from the <code class="docutils literal notranslate"><span class="pre">/&lt;robot_name&gt;/commands/joy_processed</span></code> topic and publishing
joint, gripper, and pan/tilt commands to the <strong>xs_sdk</strong> node; while the
‘waist’ joint is directly controlled via the PS3/PS4 joystick, other buttons
allow position-ik to be performed using all the arm joints. It also
publishes velocity commands to the Kobuki base.</li>
</ul>
</div>
<div class="section" id="usage">
<span id="ros-joystick-control-usage-label"></span><h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline"></a></h2>
<p>After pairing your Bluetooth joystick controller using the <a class="reference internal" href="../getting_started/pairing_controller.html"><span class="doc">Pairing Your
Controller</span></a> Guide, type the following in
a terminal (let’s say to control the locobot_wx200 robot with no lidar):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>roslaunch interbotix_xslocobot_joy xslocobot_joy.launch robot_model:<span class="o">=</span>locobot_wx200
</pre></div>
</div>
<p>A red error message might appear in the screen saying <code class="docutils literal notranslate"><span class="pre">Couldn't</span> <span class="pre">open</span> <span class="pre">joystick</span>
<span class="pre">force</span> <span class="pre">feedback!</span></code>. This is normal and will not affect the joystick operation. To
further customize the launch file at run-time, look at the table below:</p>
<table border="1" class="colwidths-given docutils align-default">
<colgroup>
<col width="20%" />
<col width="60%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>robot_model</td>
<td>model type of the Interbotix Locobot such as ‘locobot_base’ or ‘locobot_wx250s’</td>
<td>“”</td>
</tr>
<tr class="row-odd"><td>robot_name</td>
<td>name of the robot (could be anything but defaults to ‘locobot’)</td>
<td>“locobot”</td>
</tr>
<tr class="row-even"><td>use_rviz</td>
<td>launches RViz; if you are SSH’d into the robot, DON’T set this to true</td>
<td>false</td>
</tr>
<tr class="row-odd"><td>rviz_frame</td>
<td>fixed frame in RViz; this should be changed to&nbsp;<code class="docutils literal notranslate"><span class="pre">map</span></code>&nbsp;or&nbsp;<code class="docutils literal notranslate"><span class="pre">&lt;robot_name&gt;/odom</span></code>&nbsp;if mapping or using local odometry respectively</td>
<td>$(arg robot_name)/odom</td>
</tr>
<tr class="row-even"><td>use_base</td>
<td>if true, the Kobuki ROS nodes are launched</td>
<td>true</td>
</tr>
<tr class="row-odd"><td>use_lidar</td>
<td>if true, the RPLidar node is launched</td>
<td>false</td>
</tr>
<tr class="row-even"><td>show_lidar</td>
<td>set to true if the lidar is installed on the robot; this will load the lidar related links to the ‘robot_description’ parameter</td>
<td>$(arg use_lidar)</td>
</tr>
<tr class="row-odd"><td>use_camera</td>
<td>if true, the RealSense D435 camera nodes are launched</td>
<td>false</td>
</tr>
<tr class="row-even"><td>threshold</td>
<td>value from 0 to 1 defining joystick sensitivity; a larger number means the joystick should be less sensitive</td>
<td>0.75</td>
</tr>
<tr class="row-odd"><td>controller</td>
<td>type of PlayStation controller (‘ps3’ or ‘ps4’)</td>
<td>ps4</td>
</tr>
<tr class="row-even"><td>mode_configs</td>
<td>the file path to the ‘mode config’ YAML file</td>
<td>refer to&nbsp;<a class="reference external" href="https://github.com/Interbotix/interbotix_ros_rovers/blob/main/interbotix_ros_xslocobots/examples/interbotix_xslocobot_joy/launch/xslocobot_joy.launch" rel="noopener noreferrer" target="_blank">xslocobot_joy.launch</a></td>
</tr>
<tr class="row-odd"><td>use_sim</td>
<td>if true, the Dynamixel simulator node is run; use RViz to visualize the robot’s motion; if false, the real Dynamixel driver node is run</td>
<td>false</td>
</tr>
</tbody>
</table>
<p>To understand how the joystick buttons map to controlling the robot, look at the
diagram and table below:</p>
<img alt="../_images/ps3.jpg" src="../_images/ps3.jpg" />
<div class="section" id="base-control-mode">
<h3>Base Control Mode<a class="headerlink" href="#base-control-mode" title="Permalink to this headline"></a></h3>
<table border="1" class="colwidths-given docutils align-default">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Button</th>
<th class="head">Action</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Left</td>
<td>stick Up/Down	drive the Kobuki base forward/backward between 0.7 to -0.7 m/s</td>
</tr>
<tr class="row-odd"><td>R2</td>
<td>rotate the Kobuki base clockwise between 0 and -3.14 rad/s</td>
</tr>
<tr class="row-even"><td>L2</td>
<td>rotate the Kobuki base counterclockwise between 0 and 3.14 rad/s</td>
</tr>
<tr class="row-odd"><td>SELECT/SHARE</td>
<td>Reset the odometry of the base to an ‘x’,  ‘y’, and ‘theta’ of 0 (the base chirps as well)</td>
</tr>
<tr class="row-even"><td>Right</td>
<td>stick Up/Down	tilt the RealSense camera Up/Down</td>
</tr>
<tr class="row-odd"><td>Right</td>
<td>stick Left/Right	pan the RealSense camera Left/Right</td>
</tr>
<tr class="row-even"><td>START/OPTIONS</td>
<td>move the pan/tilt servo to ‘0’ radians</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="arm-control-mode">
<h3>Arm Control Mode<a class="headerlink" href="#arm-control-mode" title="Permalink to this headline"></a></h3>
<table border="1" class="colwidths-given docutils align-default">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Button</th>
<th class="head">Action</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>START/OPTIONS</td>
<td>move robot arm to its Home pose</td>
</tr>
<tr class="row-odd"><td>SELECT/SHARE</td>
<td>move robot arm to its Sleep pose</td>
</tr>
<tr class="row-even"><td>R2</td>
<td>rotate the ‘waist’ joint clockwise</td>
</tr>
<tr class="row-odd"><td>L2</td>
<td>rotate the ‘waist’ joint counterclockwise</td>
</tr>
<tr class="row-even"><td>Triangle</td>
<td>increase gripper pressure in 0.125 step increments (max is 1)</td>
</tr>
<tr class="row-odd"><td>X</td>
<td>decrease gripper pressure in 0.125 step increments (min is 0)</td>
</tr>
<tr class="row-even"><td>O</td>
<td>open gripper</td>
</tr>
<tr class="row-odd"><td>Square</td>
<td>close gripper</td>
</tr>
<tr class="row-even"><td>Right</td>
<td>stick Up/Down	increase/decrease pitch of the end-effector</td>
</tr>
<tr class="row-odd"><td>Right</td>
<td>stick Left/Right	increase/decrease roll of the end-effector</td>
</tr>
<tr class="row-even"><td>R3</td>
<td>reverses the Right stick Left/Right control</td>
</tr>
<tr class="row-odd"><td>Left</td>
<td>stick Up/Down	move the end-effector (defined at ‘ee_gripper_link’) vertically in Cartesian space</td>
</tr>
<tr class="row-even"><td>Left</td>
<td>stick Left/Right	move the end-effector (defined at ‘ee_gripper_link’) horizontally in Cartesian space</td>
</tr>
<tr class="row-odd"><td>L3</td>
<td>reverses the Left stick Left/Right control</td>
</tr>
<tr class="row-even"><td>R1</td>
<td>if the arm has 6dof,  this moves the end-effector in a negative direction along its own ‘y’ axis</td>
</tr>
<tr class="row-odd"><td>L1</td>
<td>if the arm has 6dof,  this moves the end-effector in a positive direction along its own ‘y’ axis</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="both-modes">
<h3>Both Modes<a class="headerlink" href="#both-modes" title="Permalink to this headline"></a></h3>
<table border="1" class="colwidths-given docutils align-default">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Button</th>
<th class="head">Action</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>D-pad Up</td>
<td>increase the control loop rate in 1 Hz step increments (max of 40)</td>
</tr>
<tr class="row-odd"><td>D-pad Down</td>
<td>decrease the control loop rate in 1 Hz step increments (min of 10)</td>
</tr>
<tr class="row-even"><td>D-pad Left</td>
<td>‘coarse’ control - sets the control loop rate to a user-preset ‘fast’ rate</td>
</tr>
<tr class="row-odd"><td>D-pad Right</td>
<td>‘fine’ control - sets the control loop rate to a user-preset ‘slow’ rate</td>
</tr>
<tr class="row-even"><td>PS</td>
<td>shift to the other Control Mode</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="python_demos.html" class="btn btn-neutral float-left" title="Python Demos" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="landmark_based_navigation.html" class="btn btn-neutral float-right" title="Landmark-Based Navigation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Trossen Robotics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
    <!-- Socials -->
     


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>