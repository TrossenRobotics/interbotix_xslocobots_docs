<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Navigation Stack Configuration &mdash; Interbotix X-Series LoCoBot Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_collapse.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tr_style.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python Demos" href="python_demos.html" />
    <link rel="prev" title="MoveIt 2 Motion Planning Configuration" href="moveit_motion_planning_configuration.html" />
   
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "nglikgkapv");
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <div class="sidebartitle-docs-home">
    <a href="https://docs.trossenrobotics.com/" target="_blank" class="icon icon-home">
      &nbsp;Trossen Robotics Docs Home
    </a>
    <div class="sidebartitle-docs-home-hr">
      <hr>
    </div>
  </div>
  

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_xslocobots.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../specifications.html">Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros_interface.html">ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_interface.html">Python-ROS Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros1_packages.html">ROS 1 Open Source Packages</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ros2_packages.html">ROS 2 Open Source Packages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="locobot_descriptions.html">LoCoBot Descriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="locobot_control.html">LoCoBot Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_configuration.html">Simulation Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros_control.html">ROS 2 Controllers Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="moveit_motion_planning_configuration.html">MoveIt 2 Motion Planning Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Navigation Stack Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#slam-from-scratch">SLAM From Scratch</a></li>
<li class="toctree-l4"><a class="reference internal" href="#localization">Localization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#time-out-waiting-for-transform">Time out waiting for transform...</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rejected-loop-closure">Rejected Loop Closure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#robot-does-not-go-to-same-location-after-map-reset">Robot does not go to same location after map reset</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python_demos.html">Python Demos</a></li>
<li class="toctree-l2"><a class="reference internal" href="joystick_control.html">Joystick Control</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Interbotix X-Series LoCoBots Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../ros2_packages.html">ROS 2 Open Source Packages</a></li>
      <li class="breadcrumb-item active">Navigation Stack Configuration</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/TrossenRobotics/interbotix_xslocobots_docs/blob/main/docs/ros2_packages/navigation_stack_configuration.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="navigation-stack-configuration">
<h1>Navigation Stack Configuration<a class="headerlink" href="#navigation-stack-configuration" title="Permalink to this headline"></a></h1>
<a href="https://github.com/Interbotix/interbotix_ros_rovers/tree/rolling/interbotix_ros_xslocobots/interbotix_xslocobot_nav"
    class="docs-view-on-github-button"
    target="_blank">
    <img src="../_static/GitHub-Mark-Light-32px.png"
        class="docs-view-on-github-button-gh-logo">
    View Package on GitHub
</a><div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>This package configures the ROS 2 Navigation Stack needed to give any X-Series Interbotix LoCoBot
platform the ability to perform simultaneous localization and mapping (SLAM), navigation, or just
localization. It can be used with just the <a class="reference external" href="https://www.intelrealsense.com/depth-camera-d435/" rel="noopener noreferrer" target="_blank">Intel RealSense D435</a> camera or with both the camera
and the <a class="reference external" href="https://www.slamtec.com/en/Lidar/A2" rel="noopener noreferrer" target="_blank">A2 RPLidar</a> laser scanner. Localization and mapping is done using the <a class="reference external" href="https://github.com/introlab/rtabmap_ros/tree/ros2" rel="noopener noreferrer" target="_blank">rtabmap_ros</a> or
(in some distributions) the <a class="reference external" href="https://github.com/SteveMacenski/slam_toolbox" rel="noopener noreferrer" target="_blank">slam_toolbox</a> ROS packages while navigation is accomplished via the
<a class="reference external" href="https://navigation.ros.org/" rel="noopener noreferrer" target="_blank">Nav2</a> stack.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For best results, this package should be run with the robot in an indoor, uncluttered
environment that does not contain too much sunlight and has minimal reflective surfaces.</p>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline"></a></h2>
<div class="section" id="slam-from-scratch">
<h3>SLAM From Scratch<a class="headerlink" href="#slam-from-scratch" title="Permalink to this headline"></a></h3>
<p>To get SLAM up and running using RTAB-Map, type the following in a terminal on the robot computer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ros2<span class="w"> </span>launch<span class="w"> </span>interbotix_xslocobot_nav<span class="w"> </span>xslocobot_rtabmap.launch.py<span class="w"> </span>robot_model:<span class="o">=</span>locobot_wx200<span class="w"> </span>use_lidar:<span class="o">=</span><span class="nb">true</span><span class="w"> </span>slam_mode:<span class="o">=</span>mapping<span class="w"> </span>rtabmap_args:<span class="o">=</span>-d
</pre></div>
</div>
</div>
<div class="section" id="localization">
<h3>Localization<a class="headerlink" href="#localization" title="Permalink to this headline"></a></h3>
<p>Once you've finished mapping your desired environment, the next step is to have the robot uses its
sensors to just localize itself within the map while navigating. To do so, type the following in a
terminal on the robot computer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ros2<span class="w"> </span>launch<span class="w"> </span>interbotix_xslocobot_nav<span class="w"> </span>xslocobot_rtabmap.launch.py<span class="w"> </span>robot_model:<span class="o">=</span>locobot_wx200<span class="w"> </span>use_lidar:<span class="o">=</span><span class="nb">true</span><span class="w"> </span>slam_mode:<span class="o">=</span>localization
</pre></div>
</div>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"></a></h2>
<div class="section" id="time-out-waiting-for-transform">
<h3>Time out waiting for transform...<a class="headerlink" href="#time-out-waiting-for-transform" title="Permalink to this headline"></a></h3>
<p>When starting the Nav Stack (either when continuing a map or just doing localization) on your
robot, you may see some warnings appear in the terminal. For example...</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Timed out waiting for transform from locobot_wx200/base_footprint to map to become available before running costmap, tf error: canTransform: target_frame map does not exist.. canTransform returned after 0.100567 timeout was 0.1</span>
</pre></div>
</div>
<p>The reason this appears is because no map is being supplied to the navigation stack. The reason for
that is because it takes RTAB-Map a few seconds to generate the map from its database (which could
be hundreds of megabytes). As such, this warning can be safely ignored assuming it stops once
RTAB-Map gets the map out.</p>
</div>
<div class="section" id="rejected-loop-closure">
<h3>Rejected Loop Closure<a class="headerlink" href="#rejected-loop-closure" title="Permalink to this headline"></a></h3>
<p>When starting the Nav stack or during mapping, you may see the following warning appear (or
similar) in the terminal...</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Rtabmap.cpp:2533::process() Rejected loop closure 694 -&gt; 773: Not enough inliers 0/20 (matches=0) between 694 and 772</span>
</pre></div>
</div>
<p>Similar to the first warning, this can be ignored if it only shows up a few times at node startup.
It just means that RTAB-Map has failed to determine where the robot is in the map. If you're
mapping too quickly, this warning can also appear, so slow down a bit.</p>
</div>
<div class="section" id="robot-does-not-go-to-same-location-after-map-reset">
<h3>Robot does not go to same location after map reset<a class="headerlink" href="#robot-does-not-go-to-same-location-after-map-reset" title="Permalink to this headline"></a></h3>
<p>If using the Create® 3 base, the robot keeps its odometry through sessions and power cycles. You
may need to use the /reset_pose service with each new map to ensure the robot goes to the same
location.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="moveit_motion_planning_configuration.html" class="btn btn-neutral float-left" title="MoveIt 2 Motion Planning Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="python_demos.html" class="btn btn-neutral float-right" title="Python Demos" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Trossen Robotics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>